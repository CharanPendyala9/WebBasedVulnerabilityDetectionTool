using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;
using ScriptInjectionAndDetectionTool.Core.TestScriptsExtractor;
using ScriptInjectionAndDetectionTool.Core.ModelClasses;
using ScriptInjectionAndDetectionTool.Core.Test_Executor;
using ScriptInjectionAndDetectionTool.Core.Test_Executor.Context;


namespace ScriptInjectionAndDetectionTool
{
    public partial class Form1 : Form
    {
        Selector InputSelector = new Selector();
        
        Selector SubmitSelector = new Selector();


        public string PageUrl;

        public Form1()
        {
            InitializeComponent();
            InitializeSelectorOptions();
        }

        private void button1_Click(object sender, EventArgs e)
        {
            if (textBox1.Text != "" && textBox2.Text != "" && textBox3.Text != "" && InputSelector.SelectorType!=null && SubmitSelector.SelectorType!=null)
            {
                PageUrl = textBox1.Text;
                InputSelector.SelectorValue = textBox2.Text;
                SubmitSelector.SelectorValue = textBox3.Text;

                RunTests(PageUrl, InputSelector, SubmitSelector);
            }

            else
            {
                MessageBox.Show("Please enter required fields");
            }

        }

        private void button2_Click(object sender, EventArgs e)
        {
            
        }

        //Populate the Dropdown with the required options or ways to select the elements
        private void InitializeSelectorOptions()
        {
            string[] SelectOptions = new string[] { "Id", "CssSelector", "Xpath" };
            comboBox1.Items.AddRange(SelectOptions);
            comboBox1.DropDownStyle = ComboBoxStyle.DropDownList;
            comboBox1.SelectedIndex = 0;
            InputSelector.SelectorType = "Id";

            comboBox2.Items.AddRange(SelectOptions);
            comboBox2.DropDownStyle = ComboBoxStyle.DropDownList;
            comboBox2.SelectedIndex = 0;
            SubmitSelector.SelectorType = "Id";
        }

        public void RunTests(string url, Selector InputSelector, Selector SubmitSlector)
        {
            Helper.TestUrl = url;
            TestExecutor Executor = new TestExecutor(url, InputSelector, SubmitSelector);
        }

        private void label2_Click(object sender, EventArgs e)
        {

        }

        private void comboBox1_SelectedIndexChanged(object sender, EventArgs e)
        {
            InputSelector.SelectorType = comboBox1.SelectedItem.ToString();
        }

        private void comboBox2_SelectedIndexChanged(object sender, EventArgs e)
        {
            SubmitSelector.SelectorType = comboBox2.SelectedItem.ToString();
        }
    }
}
